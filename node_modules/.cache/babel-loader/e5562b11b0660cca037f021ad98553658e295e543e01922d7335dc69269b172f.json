{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return _typeof(key) === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (_typeof(input) !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (_typeof(res) !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nimport { defineComponent, markRaw, ref, effectScope, shallowRef, computed, watch, nextTick, onMounted, openBlock, createBlock, Teleport, createVNode, Transition, withCtx, createElementVNode, normalizeClass, unref, normalizeStyle, withModifiers, createCommentVNode, createElementBlock, Fragment, resolveDynamicComponent, renderList, withDirectives, vShow, renderSlot } from 'vue';\nimport { useEventListener } from '@vueuse/core';\nimport { throttle } from 'lodash-unified';\nimport '../../../hooks/index.mjs';\nimport '../../../constants/index.mjs';\nimport '../../../utils/index.mjs';\nimport { ElIcon } from '../../icon/index.mjs';\nimport { FullScreen, ScaleToOriginal, Close, ArrowLeft, ArrowRight, ZoomOut, ZoomIn, RefreshLeft, RefreshRight } from '@element-plus/icons-vue';\nimport { imageViewerProps, imageViewerEmits } from './image-viewer.mjs';\nimport _export_sfc from '../../../_virtual/plugin-vue_export-helper.mjs';\nimport { useLocale } from '../../../hooks/use-locale/index.mjs';\nimport { useNamespace } from '../../../hooks/use-namespace/index.mjs';\nimport { useZIndex } from '../../../hooks/use-z-index/index.mjs';\nimport { isNumber } from '../../../utils/types.mjs';\nimport { EVENT_CODE } from '../../../constants/aria.mjs';\nimport { keysOf } from '../../../utils/objects.mjs';\nvar _hoisted_1 = [\"src\"];\nvar __default__ = defineComponent({\n  name: \"ElImageViewer\"\n});\nvar _sfc_main = /* @__PURE__ */defineComponent(_objectSpread(_objectSpread({}, __default__), {}, {\n  props: imageViewerProps,\n  emits: imageViewerEmits,\n  setup: function setup(__props, _ref) {\n    var expose = _ref.expose,\n      emit = _ref.emit;\n    var props = __props;\n    var modes = {\n      CONTAIN: {\n        name: \"contain\",\n        icon: markRaw(FullScreen)\n      },\n      ORIGINAL: {\n        name: \"original\",\n        icon: markRaw(ScaleToOriginal)\n      }\n    };\n    var _useLocale = useLocale(),\n      t = _useLocale.t;\n    var ns = useNamespace(\"image-viewer\");\n    var _useZIndex = useZIndex(),\n      nextZIndex = _useZIndex.nextZIndex;\n    var wrapper = ref();\n    var imgRefs = ref([]);\n    var scopeEventListener = effectScope();\n    var loading = ref(true);\n    var activeIndex = ref(props.initialIndex);\n    var mode = shallowRef(modes.CONTAIN);\n    var transform = ref({\n      scale: 1,\n      deg: 0,\n      offsetX: 0,\n      offsetY: 0,\n      enableTransition: false\n    });\n    var isSingle = computed(function () {\n      var urlList = props.urlList;\n      return urlList.length <= 1;\n    });\n    var isFirst = computed(function () {\n      return activeIndex.value === 0;\n    });\n    var isLast = computed(function () {\n      return activeIndex.value === props.urlList.length - 1;\n    });\n    var currentImg = computed(function () {\n      return props.urlList[activeIndex.value];\n    });\n    var arrowPrevKls = computed(function () {\n      return [ns.e(\"btn\"), ns.e(\"prev\"), ns.is(\"disabled\", !props.infinite && isFirst.value)];\n    });\n    var arrowNextKls = computed(function () {\n      return [ns.e(\"btn\"), ns.e(\"next\"), ns.is(\"disabled\", !props.infinite && isLast.value)];\n    });\n    var imgStyle = computed(function () {\n      var _transform$value = transform.value,\n        scale = _transform$value.scale,\n        deg = _transform$value.deg,\n        offsetX = _transform$value.offsetX,\n        offsetY = _transform$value.offsetY,\n        enableTransition = _transform$value.enableTransition;\n      var translateX = offsetX / scale;\n      var translateY = offsetY / scale;\n      switch (deg % 360) {\n        case 90:\n        case -270:\n          ;\n          var _ref2 = [translateY, -translateX];\n          translateX = _ref2[0];\n          translateY = _ref2[1];\n          break;\n        case 180:\n        case -180:\n          ;\n          var _ref3 = [-translateX, -translateY];\n          translateX = _ref3[0];\n          translateY = _ref3[1];\n          break;\n        case 270:\n        case -90:\n          ;\n          var _ref4 = [-translateY, translateX];\n          translateX = _ref4[0];\n          translateY = _ref4[1];\n          break;\n      }\n      var style = {\n        transform: \"scale(\".concat(scale, \") rotate(\").concat(deg, \"deg) translate(\").concat(translateX, \"px, \").concat(translateY, \"px)\"),\n        transition: enableTransition ? \"transform .3s\" : \"\"\n      };\n      if (mode.value.name === modes.CONTAIN.name) {\n        style.maxWidth = style.maxHeight = \"100%\";\n      }\n      return style;\n    });\n    var computedZIndex = computed(function () {\n      return isNumber(props.zIndex) ? props.zIndex : nextZIndex();\n    });\n    function hide() {\n      unregisterEventListener();\n      emit(\"close\");\n    }\n    function registerEventListener() {\n      var keydownHandler = throttle(function (e) {\n        switch (e.code) {\n          case EVENT_CODE.esc:\n            props.closeOnPressEscape && hide();\n            break;\n          case EVENT_CODE.space:\n            toggleMode();\n            break;\n          case EVENT_CODE.left:\n            prev();\n            break;\n          case EVENT_CODE.up:\n            handleActions(\"zoomIn\");\n            break;\n          case EVENT_CODE.right:\n            next();\n            break;\n          case EVENT_CODE.down:\n            handleActions(\"zoomOut\");\n            break;\n        }\n      });\n      var mousewheelHandler = throttle(function (e) {\n        var delta = e.deltaY || e.deltaX;\n        handleActions(delta < 0 ? \"zoomIn\" : \"zoomOut\", {\n          zoomRate: props.zoomRate,\n          enableTransition: false\n        });\n      });\n      scopeEventListener.run(function () {\n        useEventListener(document, \"keydown\", keydownHandler);\n        useEventListener(document, \"wheel\", mousewheelHandler);\n      });\n    }\n    function unregisterEventListener() {\n      scopeEventListener.stop();\n    }\n    function handleImgLoad() {\n      loading.value = false;\n    }\n    function handleImgError(e) {\n      loading.value = false;\n      e.target.alt = t(\"el.image.error\");\n    }\n    function handleMouseDown(e) {\n      if (loading.value || e.button !== 0 || !wrapper.value) return;\n      transform.value.enableTransition = false;\n      var _transform$value2 = transform.value,\n        offsetX = _transform$value2.offsetX,\n        offsetY = _transform$value2.offsetY;\n      var startX = e.pageX;\n      var startY = e.pageY;\n      var dragHandler = throttle(function (ev) {\n        transform.value = _objectSpread(_objectSpread({}, transform.value), {}, {\n          offsetX: offsetX + ev.pageX - startX,\n          offsetY: offsetY + ev.pageY - startY\n        });\n      });\n      var removeMousemove = useEventListener(document, \"mousemove\", dragHandler);\n      useEventListener(document, \"mouseup\", function () {\n        removeMousemove();\n      });\n      e.preventDefault();\n    }\n    function reset() {\n      transform.value = {\n        scale: 1,\n        deg: 0,\n        offsetX: 0,\n        offsetY: 0,\n        enableTransition: false\n      };\n    }\n    function toggleMode() {\n      if (loading.value) return;\n      var modeNames = keysOf(modes);\n      var modeValues = Object.values(modes);\n      var currentMode = mode.value.name;\n      var index = modeValues.findIndex(function (i) {\n        return i.name === currentMode;\n      });\n      var nextIndex = (index + 1) % modeNames.length;\n      mode.value = modes[modeNames[nextIndex]];\n      reset();\n    }\n    function setActiveItem(index) {\n      var len = props.urlList.length;\n      activeIndex.value = (index + len) % len;\n    }\n    function prev() {\n      if (isFirst.value && !props.infinite) return;\n      setActiveItem(activeIndex.value - 1);\n    }\n    function next() {\n      if (isLast.value && !props.infinite) return;\n      setActiveItem(activeIndex.value + 1);\n    }\n    function handleActions(action) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      if (loading.value) return;\n      var _zoomRate$rotateDeg$e = _objectSpread({\n          zoomRate: props.zoomRate,\n          rotateDeg: 90,\n          enableTransition: true\n        }, options),\n        zoomRate = _zoomRate$rotateDeg$e.zoomRate,\n        rotateDeg = _zoomRate$rotateDeg$e.rotateDeg,\n        enableTransition = _zoomRate$rotateDeg$e.enableTransition;\n      switch (action) {\n        case \"zoomOut\":\n          if (transform.value.scale > 0.2) {\n            transform.value.scale = Number.parseFloat((transform.value.scale / zoomRate).toFixed(3));\n          }\n          break;\n        case \"zoomIn\":\n          if (transform.value.scale < 7) {\n            transform.value.scale = Number.parseFloat((transform.value.scale * zoomRate).toFixed(3));\n          }\n          break;\n        case \"clockwise\":\n          transform.value.deg += rotateDeg;\n          break;\n        case \"anticlockwise\":\n          transform.value.deg -= rotateDeg;\n          break;\n      }\n      transform.value.enableTransition = enableTransition;\n    }\n    watch(currentImg, function () {\n      nextTick(function () {\n        var $img = imgRefs.value[0];\n        if (!($img == null ? void 0 : $img.complete)) {\n          loading.value = true;\n        }\n      });\n    });\n    watch(activeIndex, function (val) {\n      reset();\n      emit(\"switch\", val);\n    });\n    onMounted(function () {\n      var _a, _b;\n      registerEventListener();\n      (_b = (_a = wrapper.value) == null ? void 0 : _a.focus) == null ? void 0 : _b.call(_a);\n    });\n    expose({\n      setActiveItem: setActiveItem\n    });\n    return function (_ctx, _cache) {\n      return openBlock(), createBlock(Teleport, {\n        to: \"body\",\n        disabled: !_ctx.teleported\n      }, [createVNode(Transition, {\n        name: \"viewer-fade\",\n        appear: \"\"\n      }, {\n        \"default\": withCtx(function () {\n          return [createElementVNode(\"div\", {\n            ref_key: \"wrapper\",\n            ref: wrapper,\n            tabindex: -1,\n            \"class\": normalizeClass(unref(ns).e(\"wrapper\")),\n            style: normalizeStyle({\n              zIndex: unref(computedZIndex)\n            })\n          }, [createElementVNode(\"div\", {\n            \"class\": normalizeClass(unref(ns).e(\"mask\")),\n            onClick: _cache[0] || (_cache[0] = withModifiers(function ($event) {\n              return _ctx.hideOnClickModal && hide();\n            }, [\"self\"]))\n          }, null, 2), createCommentVNode(\" CLOSE \"), createElementVNode(\"span\", {\n            \"class\": normalizeClass([unref(ns).e(\"btn\"), unref(ns).e(\"close\")]),\n            onClick: hide\n          }, [createVNode(unref(ElIcon), null, {\n            \"default\": withCtx(function () {\n              return [createVNode(unref(Close))];\n            }),\n            _: 1\n          })], 2), createCommentVNode(\" ARROW \"), !unref(isSingle) ? (openBlock(), createElementBlock(Fragment, {\n            key: 0\n          }, [createElementVNode(\"span\", {\n            \"class\": normalizeClass(unref(arrowPrevKls)),\n            onClick: prev\n          }, [createVNode(unref(ElIcon), null, {\n            \"default\": withCtx(function () {\n              return [createVNode(unref(ArrowLeft))];\n            }),\n            _: 1\n          })], 2), createElementVNode(\"span\", {\n            \"class\": normalizeClass(unref(arrowNextKls)),\n            onClick: next\n          }, [createVNode(unref(ElIcon), null, {\n            \"default\": withCtx(function () {\n              return [createVNode(unref(ArrowRight))];\n            }),\n            _: 1\n          })], 2)], 64)) : createCommentVNode(\"v-if\", true), createCommentVNode(\" ACTIONS \"), createElementVNode(\"div\", {\n            \"class\": normalizeClass([unref(ns).e(\"btn\"), unref(ns).e(\"actions\")])\n          }, [createElementVNode(\"div\", {\n            \"class\": normalizeClass(unref(ns).e(\"actions__inner\"))\n          }, [createVNode(unref(ElIcon), {\n            onClick: _cache[1] || (_cache[1] = function ($event) {\n              return handleActions(\"zoomOut\");\n            })\n          }, {\n            \"default\": withCtx(function () {\n              return [createVNode(unref(ZoomOut))];\n            }),\n            _: 1\n          }), createVNode(unref(ElIcon), {\n            onClick: _cache[2] || (_cache[2] = function ($event) {\n              return handleActions(\"zoomIn\");\n            })\n          }, {\n            \"default\": withCtx(function () {\n              return [createVNode(unref(ZoomIn))];\n            }),\n            _: 1\n          }), createElementVNode(\"i\", {\n            \"class\": normalizeClass(unref(ns).e(\"actions__divider\"))\n          }, null, 2), createVNode(unref(ElIcon), {\n            onClick: toggleMode\n          }, {\n            \"default\": withCtx(function () {\n              return [(openBlock(), createBlock(resolveDynamicComponent(unref(mode).icon)))];\n            }),\n            _: 1\n          }), createElementVNode(\"i\", {\n            \"class\": normalizeClass(unref(ns).e(\"actions__divider\"))\n          }, null, 2), createVNode(unref(ElIcon), {\n            onClick: _cache[3] || (_cache[3] = function ($event) {\n              return handleActions(\"anticlockwise\");\n            })\n          }, {\n            \"default\": withCtx(function () {\n              return [createVNode(unref(RefreshLeft))];\n            }),\n            _: 1\n          }), createVNode(unref(ElIcon), {\n            onClick: _cache[4] || (_cache[4] = function ($event) {\n              return handleActions(\"clockwise\");\n            })\n          }, {\n            \"default\": withCtx(function () {\n              return [createVNode(unref(RefreshRight))];\n            }),\n            _: 1\n          })], 2)], 2), createCommentVNode(\" CANVAS \"), createElementVNode(\"div\", {\n            \"class\": normalizeClass(unref(ns).e(\"canvas\"))\n          }, [(openBlock(true), createElementBlock(Fragment, null, renderList(_ctx.urlList, function (url, i) {\n            return withDirectives((openBlock(), createElementBlock(\"img\", {\n              ref_for: true,\n              ref: function ref(el) {\n                return imgRefs.value[i] = el;\n              },\n              key: url,\n              src: url,\n              style: normalizeStyle(unref(imgStyle)),\n              \"class\": normalizeClass(unref(ns).e(\"img\")),\n              onLoad: handleImgLoad,\n              onError: handleImgError,\n              onMousedown: handleMouseDown\n            }, null, 46, _hoisted_1)), [[vShow, i === activeIndex.value]]);\n          }), 128))], 2), renderSlot(_ctx.$slots, \"default\")], 6)];\n        }),\n        _: 3\n      })], 8, [\"disabled\"]);\n    };\n  }\n}));\nvar ImageViewer = /* @__PURE__ */_export_sfc(_sfc_main, [[\"__file\", \"/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue\"]]);\nexport { ImageViewer as default };","map":{"version":3,"names":["name","modes","CONTAIN","icon","markRaw","FullScreen","ORIGINAL","ScaleToOriginal","_useLocale","useLocale","t","ns","useNamespace","_useZIndex","useZIndex","nextZIndex","wrapper","ref","imgRefs","scopeEventListener","effectScope","loading","activeIndex","props","initialIndex","mode","shallowRef","transform","scale","deg","offsetX","offsetY","enableTransition","isSingle","computed","urlList","length","isFirst","value","isLast","currentImg","arrowPrevKls","e","is","infinite","arrowNextKls","imgStyle","_transform$value","translateX","translateY","_ref2","_ref3","_ref4","style","concat","transition","maxWidth","maxHeight","computedZIndex","isNumber","zIndex","hide","unregisterEventListener","emit","registerEventListener","keydownHandler","throttle","code","EVENT_CODE","esc","closeOnPressEscape","space","toggleMode","left","prev","up","handleActions","right","next","down","mousewheelHandler","delta","deltaY","deltaX","zoomRate","run","useEventListener","document","stop","handleImgLoad","handleImgError","target","alt","handleMouseDown","button","_transform$value2","startX","pageX","startY","pageY","dragHandler","ev","_objectSpread","removeMousemove","preventDefault","reset","modeNames","keysOf","modeValues","Object","values","currentMode","index","findIndex","i","nextIndex","setActiveItem","len","action","options","arguments","undefined","_zoomRate$rotateDeg$e","rotateDeg","Number","parseFloat","toFixed","watch","nextTick","$img","complete","val","onMounted","_a","_b","focus","call","expose"],"sources":["../../../../../../packages/components/image-viewer/src/image-viewer.vue"],"sourcesContent":["<template>\n  <teleport to=\"body\" :disabled=\"!teleported\">\n    <transition name=\"viewer-fade\" appear>\n      <div\n        ref=\"wrapper\"\n        :tabindex=\"-1\"\n        :class=\"ns.e('wrapper')\"\n        :style=\"{ zIndex: computedZIndex }\"\n      >\n        <div :class=\"ns.e('mask')\" @click.self=\"hideOnClickModal && hide()\" />\n\n        <!-- CLOSE -->\n        <span :class=\"[ns.e('btn'), ns.e('close')]\" @click=\"hide\">\n          <el-icon><Close /></el-icon>\n        </span>\n\n        <!-- ARROW -->\n        <template v-if=\"!isSingle\">\n          <span :class=\"arrowPrevKls\" @click=\"prev\">\n            <el-icon><ArrowLeft /></el-icon>\n          </span>\n          <span :class=\"arrowNextKls\" @click=\"next\">\n            <el-icon><ArrowRight /></el-icon>\n          </span>\n        </template>\n        <!-- ACTIONS -->\n        <div :class=\"[ns.e('btn'), ns.e('actions')]\">\n          <div :class=\"ns.e('actions__inner')\">\n            <el-icon @click=\"handleActions('zoomOut')\">\n              <ZoomOut />\n            </el-icon>\n            <el-icon @click=\"handleActions('zoomIn')\">\n              <ZoomIn />\n            </el-icon>\n            <i :class=\"ns.e('actions__divider')\" />\n            <el-icon @click=\"toggleMode\">\n              <component :is=\"mode.icon\" />\n            </el-icon>\n            <i :class=\"ns.e('actions__divider')\" />\n            <el-icon @click=\"handleActions('anticlockwise')\">\n              <RefreshLeft />\n            </el-icon>\n            <el-icon @click=\"handleActions('clockwise')\">\n              <RefreshRight />\n            </el-icon>\n          </div>\n        </div>\n        <!-- CANVAS -->\n        <div :class=\"ns.e('canvas')\">\n          <img\n            v-for=\"(url, i) in urlList\"\n            v-show=\"i === activeIndex\"\n            :ref=\"(el) => (imgRefs[i] = el as HTMLImageElement)\"\n            :key=\"url\"\n            :src=\"url\"\n            :style=\"imgStyle\"\n            :class=\"ns.e('img')\"\n            @load=\"handleImgLoad\"\n            @error=\"handleImgError\"\n            @mousedown=\"handleMouseDown\"\n          />\n        </div>\n        <slot />\n      </div>\n    </transition>\n  </teleport>\n</template>\n\n<script lang=\"ts\" setup>\nimport {\n  computed,\n  effectScope,\n  markRaw,\n  nextTick,\n  onMounted,\n  ref,\n  shallowRef,\n  watch,\n} from 'vue'\nimport { useEventListener } from '@vueuse/core'\nimport { throttle } from 'lodash-unified'\nimport { useLocale, useNamespace, useZIndex } from '@element-plus/hooks'\nimport { EVENT_CODE } from '@element-plus/constants'\nimport { isNumber, keysOf } from '@element-plus/utils'\nimport ElIcon from '@element-plus/components/icon'\nimport {\n  ArrowLeft,\n  ArrowRight,\n  Close,\n  FullScreen,\n  RefreshLeft,\n  RefreshRight,\n  ScaleToOriginal,\n  ZoomIn,\n  ZoomOut,\n} from '@element-plus/icons-vue'\nimport { imageViewerEmits, imageViewerProps } from './image-viewer'\n\nimport type { CSSProperties } from 'vue'\nimport type { ImageViewerAction, ImageViewerMode } from './image-viewer'\n\nconst modes: Record<'CONTAIN' | 'ORIGINAL', ImageViewerMode> = {\n  CONTAIN: {\n    name: 'contain',\n    icon: markRaw(FullScreen),\n  },\n  ORIGINAL: {\n    name: 'original',\n    icon: markRaw(ScaleToOriginal),\n  },\n}\n\ndefineOptions({\n  name: 'ElImageViewer',\n})\n\nconst props = defineProps(imageViewerProps)\nconst emit = defineEmits(imageViewerEmits)\n\nconst { t } = useLocale()\nconst ns = useNamespace('image-viewer')\nconst { nextZIndex } = useZIndex()\nconst wrapper = ref<HTMLDivElement>()\nconst imgRefs = ref<HTMLImageElement[]>([])\n\nconst scopeEventListener = effectScope()\n\nconst loading = ref(true)\nconst activeIndex = ref(props.initialIndex)\nconst mode = shallowRef<ImageViewerMode>(modes.CONTAIN)\nconst transform = ref({\n  scale: 1,\n  deg: 0,\n  offsetX: 0,\n  offsetY: 0,\n  enableTransition: false,\n})\n\nconst isSingle = computed(() => {\n  const { urlList } = props\n  return urlList.length <= 1\n})\n\nconst isFirst = computed(() => {\n  return activeIndex.value === 0\n})\n\nconst isLast = computed(() => {\n  return activeIndex.value === props.urlList.length - 1\n})\n\nconst currentImg = computed(() => {\n  return props.urlList[activeIndex.value]\n})\n\nconst arrowPrevKls = computed(() => [\n  ns.e('btn'),\n  ns.e('prev'),\n  ns.is('disabled', !props.infinite && isFirst.value),\n])\n\nconst arrowNextKls = computed(() => [\n  ns.e('btn'),\n  ns.e('next'),\n  ns.is('disabled', !props.infinite && isLast.value),\n])\n\nconst imgStyle = computed(() => {\n  const { scale, deg, offsetX, offsetY, enableTransition } = transform.value\n  let translateX = offsetX / scale\n  let translateY = offsetY / scale\n\n  switch (deg % 360) {\n    case 90:\n    case -270:\n      ;[translateX, translateY] = [translateY, -translateX]\n      break\n    case 180:\n    case -180:\n      ;[translateX, translateY] = [-translateX, -translateY]\n      break\n    case 270:\n    case -90:\n      ;[translateX, translateY] = [-translateY, translateX]\n      break\n  }\n\n  const style: CSSProperties = {\n    transform: `scale(${scale}) rotate(${deg}deg) translate(${translateX}px, ${translateY}px)`,\n    transition: enableTransition ? 'transform .3s' : '',\n  }\n  if (mode.value.name === modes.CONTAIN.name) {\n    style.maxWidth = style.maxHeight = '100%'\n  }\n  return style\n})\n\nconst computedZIndex = computed(() => {\n  return isNumber(props.zIndex) ? props.zIndex : nextZIndex()\n})\n\nfunction hide() {\n  unregisterEventListener()\n  emit('close')\n}\n\nfunction registerEventListener() {\n  const keydownHandler = throttle((e: KeyboardEvent) => {\n    switch (e.code) {\n      // ESC\n      case EVENT_CODE.esc:\n        props.closeOnPressEscape && hide()\n        break\n      // SPACE\n      case EVENT_CODE.space:\n        toggleMode()\n        break\n      // LEFT_ARROW\n      case EVENT_CODE.left:\n        prev()\n        break\n      // UP_ARROW\n      case EVENT_CODE.up:\n        handleActions('zoomIn')\n        break\n      // RIGHT_ARROW\n      case EVENT_CODE.right:\n        next()\n        break\n      // DOWN_ARROW\n      case EVENT_CODE.down:\n        handleActions('zoomOut')\n        break\n    }\n  })\n  const mousewheelHandler = throttle((e: WheelEvent) => {\n    const delta = e.deltaY || e.deltaX\n    handleActions(delta < 0 ? 'zoomIn' : 'zoomOut', {\n      zoomRate: props.zoomRate,\n      enableTransition: false,\n    })\n  })\n\n  scopeEventListener.run(() => {\n    useEventListener(document, 'keydown', keydownHandler)\n    useEventListener(document, 'wheel', mousewheelHandler)\n  })\n}\n\nfunction unregisterEventListener() {\n  scopeEventListener.stop()\n}\n\nfunction handleImgLoad() {\n  loading.value = false\n}\n\nfunction handleImgError(e: Event) {\n  loading.value = false\n  ;(e.target as HTMLImageElement).alt = t('el.image.error')\n}\n\nfunction handleMouseDown(e: MouseEvent) {\n  if (loading.value || e.button !== 0 || !wrapper.value) return\n  transform.value.enableTransition = false\n\n  const { offsetX, offsetY } = transform.value\n  const startX = e.pageX\n  const startY = e.pageY\n\n  const dragHandler = throttle((ev: MouseEvent) => {\n    transform.value = {\n      ...transform.value,\n      offsetX: offsetX + ev.pageX - startX,\n      offsetY: offsetY + ev.pageY - startY,\n    }\n  })\n  const removeMousemove = useEventListener(document, 'mousemove', dragHandler)\n  useEventListener(document, 'mouseup', () => {\n    removeMousemove()\n  })\n\n  e.preventDefault()\n}\n\nfunction reset() {\n  transform.value = {\n    scale: 1,\n    deg: 0,\n    offsetX: 0,\n    offsetY: 0,\n    enableTransition: false,\n  }\n}\n\nfunction toggleMode() {\n  if (loading.value) return\n\n  const modeNames = keysOf(modes)\n  const modeValues = Object.values(modes)\n  const currentMode = mode.value.name\n  const index = modeValues.findIndex((i) => i.name === currentMode)\n  const nextIndex = (index + 1) % modeNames.length\n  mode.value = modes[modeNames[nextIndex]]\n  reset()\n}\n\nfunction setActiveItem(index: number) {\n  const len = props.urlList.length\n  activeIndex.value = (index + len) % len\n}\n\nfunction prev() {\n  if (isFirst.value && !props.infinite) return\n  setActiveItem(activeIndex.value - 1)\n}\n\nfunction next() {\n  if (isLast.value && !props.infinite) return\n  setActiveItem(activeIndex.value + 1)\n}\n\nfunction handleActions(action: ImageViewerAction, options = {}) {\n  if (loading.value) return\n  const { zoomRate, rotateDeg, enableTransition } = {\n    zoomRate: props.zoomRate,\n    rotateDeg: 90,\n    enableTransition: true,\n    ...options,\n  }\n  switch (action) {\n    case 'zoomOut':\n      if (transform.value.scale > 0.2) {\n        transform.value.scale = Number.parseFloat(\n          (transform.value.scale / zoomRate).toFixed(3)\n        )\n      }\n      break\n    case 'zoomIn':\n      if (transform.value.scale < 7) {\n        transform.value.scale = Number.parseFloat(\n          (transform.value.scale * zoomRate).toFixed(3)\n        )\n      }\n      break\n    case 'clockwise':\n      transform.value.deg += rotateDeg\n      break\n    case 'anticlockwise':\n      transform.value.deg -= rotateDeg\n      break\n  }\n  transform.value.enableTransition = enableTransition\n}\n\nwatch(currentImg, () => {\n  nextTick(() => {\n    const $img = imgRefs.value[0]\n    if (!$img?.complete) {\n      loading.value = true\n    }\n  })\n})\n\nwatch(activeIndex, (val) => {\n  reset()\n  emit('switch', val)\n})\n\nonMounted(() => {\n  registerEventListener()\n  // add tabindex then wrapper can be focusable via Javascript\n  // focus wrapper so arrow key can't cause inner scroll behavior underneath\n  wrapper.value?.focus?.()\n})\n\ndefineExpose({\n  /**\n   * @description manually switch image\n   */\n  setActiveItem,\n})\n</script>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}