{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return _typeof(key) === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (_typeof(input) !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (_typeof(res) !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _iterableToArrayLimit(arr, i) { var _i = null == arr ? null : \"undefined\" != typeof Symbol && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0); } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i[\"return\"] && (_r = _i[\"return\"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nimport { computed, unref, shallowRef, ref, watch, onBeforeUnmount } from 'vue';\nimport { createPopper } from '@popperjs/core';\nimport { fromPairs } from 'lodash-unified';\nvar usePopper = function usePopper(referenceElementRef, popperElementRef) {\n  var opts = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var stateUpdater = {\n    name: \"updateState\",\n    enabled: true,\n    phase: \"write\",\n    fn: function fn(_ref) {\n      var state = _ref.state;\n      var derivedState = deriveState(state);\n      Object.assign(states.value, derivedState);\n    },\n    requires: [\"computeStyles\"]\n  };\n  var options = computed(function () {\n    var _unref = unref(opts),\n      onFirstUpdate = _unref.onFirstUpdate,\n      placement = _unref.placement,\n      strategy = _unref.strategy,\n      modifiers = _unref.modifiers;\n    return {\n      onFirstUpdate: onFirstUpdate,\n      placement: placement || \"bottom\",\n      strategy: strategy || \"absolute\",\n      modifiers: [].concat(_toConsumableArray(modifiers || []), [stateUpdater, {\n        name: \"applyStyles\",\n        enabled: false\n      }])\n    };\n  });\n  var instanceRef = shallowRef();\n  var states = ref({\n    styles: {\n      popper: {\n        position: unref(options).strategy,\n        left: \"0\",\n        top: \"0\"\n      },\n      arrow: {\n        position: \"absolute\"\n      }\n    },\n    attributes: {}\n  });\n  var destroy = function destroy() {\n    if (!instanceRef.value) return;\n    instanceRef.value.destroy();\n    instanceRef.value = void 0;\n  };\n  watch(options, function (newOptions) {\n    var instance = unref(instanceRef);\n    if (instance) {\n      instance.setOptions(newOptions);\n    }\n  }, {\n    deep: true\n  });\n  watch([referenceElementRef, popperElementRef], function (_ref2) {\n    var _ref3 = _slicedToArray(_ref2, 2),\n      referenceElement = _ref3[0],\n      popperElement = _ref3[1];\n    destroy();\n    if (!referenceElement || !popperElement) return;\n    instanceRef.value = createPopper(referenceElement, popperElement, unref(options));\n  });\n  onBeforeUnmount(function () {\n    destroy();\n  });\n  return {\n    state: computed(function () {\n      var _a;\n      return _objectSpread({}, ((_a = unref(instanceRef)) == null ? void 0 : _a.state) || {});\n    }),\n    styles: computed(function () {\n      return unref(states).styles;\n    }),\n    attributes: computed(function () {\n      return unref(states).attributes;\n    }),\n    update: function update() {\n      var _a;\n      return (_a = unref(instanceRef)) == null ? void 0 : _a.update();\n    },\n    forceUpdate: function forceUpdate() {\n      var _a;\n      return (_a = unref(instanceRef)) == null ? void 0 : _a.forceUpdate();\n    },\n    instanceRef: computed(function () {\n      return unref(instanceRef);\n    })\n  };\n};\nfunction deriveState(state) {\n  var elements = Object.keys(state.elements);\n  var styles = fromPairs(elements.map(function (element) {\n    return [element, state.styles[element] || {}];\n  }));\n  var attributes = fromPairs(elements.map(function (element) {\n    return [element, state.attributes[element]];\n  }));\n  return {\n    styles: styles,\n    attributes: attributes\n  };\n}\nexport { usePopper };","map":{"version":3,"names":["usePopper","referenceElementRef","popperElementRef","opts","arguments","length","undefined","stateUpdater","name","enabled","phase","fn","_ref","state","derivedState","deriveState","Object","assign","states","value","requires","options","computed","_unref","unref","onFirstUpdate","placement","strategy","modifiers","concat","_toConsumableArray","instanceRef","shallowRef","ref","styles","popper","position","left","top","arrow","attributes","destroy","watch","newOptions","instance","setOptions","deep","_ref2","_ref3","_slicedToArray","referenceElement","popperElement","createPopper","onBeforeUnmount","_a","_objectSpread","update","forceUpdate","elements","keys","fromPairs","map","element"],"sources":["../../../../../packages/hooks/use-popper/index.ts"],"sourcesContent":["import { computed, onBeforeUnmount, ref, shallowRef, unref, watch } from 'vue'\nimport { createPopper } from '@popperjs/core'\nimport { fromPairs } from 'lodash-unified'\n\nimport type { Ref } from 'vue'\nimport type {\n  Instance,\n  Modifier,\n  Options,\n  State,\n  VirtualElement,\n} from '@popperjs/core'\n\ntype ElementType = HTMLElement | undefined\ntype ReferenceElement = ElementType | VirtualElement\nexport type PartialOptions = Partial<Options>\n\nexport const usePopper = (\n  referenceElementRef: Ref<ReferenceElement>,\n  popperElementRef: Ref<ElementType>,\n  opts: Ref<PartialOptions> | PartialOptions = {} as PartialOptions\n) => {\n  const stateUpdater = {\n    name: 'updateState',\n    enabled: true,\n    phase: 'write',\n    fn: ({ state }) => {\n      const derivedState = deriveState(state)\n\n      Object.assign(states.value, derivedState)\n    },\n    requires: ['computeStyles'],\n  } as Modifier<'updateState', any>\n\n  const options = computed<Options>(() => {\n    const { onFirstUpdate, placement, strategy, modifiers } = unref(opts)\n\n    return {\n      onFirstUpdate,\n      placement: placement || 'bottom',\n      strategy: strategy || 'absolute',\n      modifiers: [\n        ...(modifiers || []),\n        stateUpdater,\n        { name: 'applyStyles', enabled: false },\n      ],\n    }\n  })\n\n  const instanceRef = shallowRef<Instance | undefined>()\n  const states = ref<Pick<State, 'styles' | 'attributes'>>({\n    styles: {\n      popper: {\n        position: unref(options).strategy,\n        left: '0',\n        top: '0',\n      },\n      arrow: {\n        position: 'absolute',\n      },\n    },\n    attributes: {},\n  })\n\n  const destroy = () => {\n    if (!instanceRef.value) return\n\n    instanceRef.value.destroy()\n    instanceRef.value = undefined\n  }\n\n  watch(\n    options,\n    (newOptions) => {\n      const instance = unref(instanceRef)\n      if (instance) {\n        instance.setOptions(newOptions)\n      }\n    },\n    {\n      deep: true,\n    }\n  )\n\n  watch(\n    [referenceElementRef, popperElementRef],\n    ([referenceElement, popperElement]) => {\n      destroy()\n      if (!referenceElement || !popperElement) return\n\n      instanceRef.value = createPopper(\n        referenceElement,\n        popperElement,\n        unref(options)\n      )\n    }\n  )\n\n  onBeforeUnmount(() => {\n    destroy()\n  })\n\n  return {\n    state: computed(() => ({ ...(unref(instanceRef)?.state || {}) })),\n    styles: computed(() => unref(states).styles),\n    attributes: computed(() => unref(states).attributes),\n    update: () => unref(instanceRef)?.update(),\n    forceUpdate: () => unref(instanceRef)?.forceUpdate(),\n    // Preventing end users from modifying the instance.\n    instanceRef: computed(() => unref(instanceRef)),\n  }\n}\n\nfunction deriveState(state: State) {\n  const elements = Object.keys(state.elements) as unknown as Array<\n    keyof State['elements']\n  >\n\n  const styles = fromPairs(\n    elements.map(\n      (element) =>\n        [element, state.styles[element] || {}] as [\n          string,\n          State['styles'][keyof State['styles']]\n        ]\n    )\n  )\n\n  const attributes = fromPairs(\n    elements.map(\n      (element) =>\n        [element, state.attributes[element]] as [\n          string,\n          State['attributes'][keyof State['attributes']]\n        ]\n    )\n  )\n\n  return {\n    styles,\n    attributes,\n  }\n}\n\nexport type UsePopperReturn = ReturnType<typeof usePopper>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}