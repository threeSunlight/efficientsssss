{"ast":null,"code":"import { inject, computed, ref } from 'vue';\nimport '../../../utils/index.mjs';\nimport '../../../constants/index.mjs';\nimport '../../../hooks/index.mjs';\nimport { useNamespace } from '../../../hooks/use-namespace/index.mjs';\nimport { generateId } from '../../../utils/rand.mjs';\nimport { EVENT_CODE } from '../../../constants/aria.mjs';\nimport { addClass } from '../../../utils/dom/style.mjs';\nvar useDropdown = function useDropdown() {\n  var elDropdown = inject(\"elDropdown\", {});\n  var _elDropdownSize = computed(function () {\n    return elDropdown == null ? void 0 : elDropdown.dropdownSize;\n  });\n  return {\n    elDropdown: elDropdown,\n    _elDropdownSize: _elDropdownSize\n  };\n};\nvar initDropdownDomEvent = function initDropdownDomEvent(dropdownChildren, triggerElm, _instance) {\n  var ns = useNamespace(\"dropdown\");\n  var menuItems = ref(null);\n  var menuItemsArray = ref(null);\n  var dropdownElm = ref(null);\n  var listId = ref(\"dropdown-menu-\".concat(generateId()));\n  dropdownElm.value = dropdownChildren == null ? void 0 : dropdownChildren.subTree.el;\n  function removeTabindex() {\n    var _a;\n    triggerElm.setAttribute(\"tabindex\", \"-1\");\n    (_a = menuItemsArray.value) == null ? void 0 : _a.forEach(function (item) {\n      item.setAttribute(\"tabindex\", \"-1\");\n    });\n  }\n  function resetTabindex(ele) {\n    removeTabindex();\n    ele == null ? void 0 : ele.setAttribute(\"tabindex\", \"0\");\n  }\n  function handleTriggerKeyDown(ev) {\n    var code = ev.code;\n    if ([EVENT_CODE.up, EVENT_CODE.down].includes(code)) {\n      removeTabindex();\n      resetTabindex(menuItems.value[0]);\n      menuItems.value[0].focus();\n      ev.preventDefault();\n      ev.stopPropagation();\n    } else if (code === EVENT_CODE.enter) {\n      _instance.handleClick();\n    } else if ([EVENT_CODE.tab, EVENT_CODE.esc].includes(code)) {\n      _instance.hide();\n    }\n  }\n  function handleItemKeyDown(ev) {\n    var code = ev.code;\n    var target = ev.target;\n    var currentIndex = menuItemsArray.value.indexOf(target);\n    var max = menuItemsArray.value.length - 1;\n    var nextIndex;\n    if ([EVENT_CODE.up, EVENT_CODE.down].includes(code)) {\n      if (code === EVENT_CODE.up) {\n        nextIndex = currentIndex !== 0 ? currentIndex - 1 : 0;\n      } else {\n        nextIndex = currentIndex < max ? currentIndex + 1 : max;\n      }\n      removeTabindex();\n      resetTabindex(menuItems.value[nextIndex]);\n      menuItems.value[nextIndex].focus();\n      ev.preventDefault();\n      ev.stopPropagation();\n    } else if (code === EVENT_CODE.enter) {\n      triggerElmFocus();\n      target.click();\n      if (_instance.props.hideOnClick) {\n        _instance.hide();\n      }\n    } else if ([EVENT_CODE.tab, EVENT_CODE.esc].includes(code)) {\n      _instance.hide();\n      triggerElmFocus();\n    }\n  }\n  function initAria() {\n    dropdownElm.value.setAttribute(\"id\", listId.value);\n    triggerElm.setAttribute(\"aria-haspopup\", \"list\");\n    triggerElm.setAttribute(\"aria-controls\", listId.value);\n    if (!_instance.props.splitButton) {\n      triggerElm.setAttribute(\"role\", \"button\");\n      triggerElm.setAttribute(\"tabindex\", _instance.props.tabindex);\n      addClass(triggerElm, ns.b(\"selfdefine\"));\n    }\n  }\n  function initEvent() {\n    var _a;\n    triggerElm == null ? void 0 : triggerElm.addEventListener(\"keydown\", handleTriggerKeyDown);\n    (_a = dropdownElm.value) == null ? void 0 : _a.addEventListener(\"keydown\", handleItemKeyDown, true);\n  }\n  function initDomOperation() {\n    menuItems.value = dropdownElm.value.querySelectorAll(\"[tabindex='-1']\");\n    menuItemsArray.value = Array.from(menuItems.value);\n    initEvent();\n    initAria();\n  }\n  function triggerElmFocus() {\n    triggerElm.focus();\n  }\n  initDomOperation();\n};\nexport { initDropdownDomEvent, useDropdown };","map":{"version":3,"names":["useDropdown","elDropdown","inject","_elDropdownSize","computed","dropdownSize","initDropdownDomEvent","dropdownChildren","triggerElm","_instance","ns","useNamespace","menuItems","ref","menuItemsArray","dropdownElm","listId","concat","generateId","value","subTree","el","removeTabindex","_a","setAttribute","forEach","item","resetTabindex","ele","handleTriggerKeyDown","ev","code","EVENT_CODE","up","down","includes","focus","preventDefault","stopPropagation","enter","handleClick","tab","esc","hide","handleItemKeyDown","target","currentIndex","indexOf","max","length","nextIndex","triggerElmFocus","click","props","hideOnClick","initAria","splitButton","tabindex","addClass","b","initEvent","addEventListener","initDomOperation","querySelectorAll","Array","from"],"sources":["../../../../../../packages/components/dropdown/src/useDropdown.ts"],"sourcesContent":["// @ts-nocheck\nimport { computed, inject, ref } from 'vue'\nimport { addClass, generateId } from '@element-plus/utils'\nimport { EVENT_CODE } from '@element-plus/constants'\nimport { useNamespace } from '@element-plus/hooks'\nimport type { Nullable } from '@element-plus/utils'\nimport type { IElDropdownInstance } from './dropdown'\n\nexport const useDropdown = () => {\n  const elDropdown = inject<IElDropdownInstance>('elDropdown', {})\n  const _elDropdownSize = computed(() => elDropdown?.dropdownSize)\n\n  return {\n    elDropdown,\n    _elDropdownSize,\n  }\n}\n\nexport const initDropdownDomEvent = (\n  dropdownChildren,\n  triggerElm,\n  _instance\n) => {\n  const ns = useNamespace('dropdown')\n  const menuItems = ref<Nullable<HTMLButtonElement[]>>(null)\n  const menuItemsArray = ref<Nullable<HTMLElement[]>>(null)\n  const dropdownElm = ref<Nullable<HTMLElement>>(null)\n  const listId = ref(`dropdown-menu-${generateId()}`)\n  dropdownElm.value = dropdownChildren?.subTree.el\n\n  function removeTabindex() {\n    triggerElm.setAttribute('tabindex', '-1')\n    menuItemsArray.value?.forEach((item) => {\n      item.setAttribute('tabindex', '-1')\n    })\n  }\n\n  function resetTabindex(ele) {\n    removeTabindex()\n    ele?.setAttribute('tabindex', '0')\n  }\n\n  function handleTriggerKeyDown(ev: KeyboardEvent) {\n    const code = ev.code\n    if ([EVENT_CODE.up, EVENT_CODE.down].includes(code)) {\n      removeTabindex()\n      resetTabindex(menuItems.value[0])\n      menuItems.value[0].focus()\n      ev.preventDefault()\n      ev.stopPropagation()\n    } else if (code === EVENT_CODE.enter) {\n      _instance.handleClick()\n    } else if ([EVENT_CODE.tab, EVENT_CODE.esc].includes(code)) {\n      _instance.hide()\n    }\n  }\n\n  function handleItemKeyDown(ev) {\n    const code = ev.code\n    const target = ev.target\n    const currentIndex = menuItemsArray.value.indexOf(target)\n    const max = menuItemsArray.value.length - 1\n    let nextIndex\n    if ([EVENT_CODE.up, EVENT_CODE.down].includes(code)) {\n      if (code === EVENT_CODE.up) {\n        nextIndex = currentIndex !== 0 ? currentIndex - 1 : 0\n      } else {\n        nextIndex = currentIndex < max ? currentIndex + 1 : max\n      }\n      removeTabindex()\n      resetTabindex(menuItems.value[nextIndex])\n      menuItems.value[nextIndex].focus()\n      ev.preventDefault()\n      ev.stopPropagation()\n    } else if (code === EVENT_CODE.enter) {\n      triggerElmFocus()\n      target.click()\n      if (_instance.props.hideOnClick) {\n        _instance.hide()\n      }\n    } else if ([EVENT_CODE.tab, EVENT_CODE.esc].includes(code)) {\n      _instance.hide()\n      triggerElmFocus()\n    }\n  }\n\n  function initAria() {\n    dropdownElm.value.setAttribute('id', listId.value)\n    triggerElm.setAttribute('aria-haspopup', 'list')\n    triggerElm.setAttribute('aria-controls', listId.value)\n    if (!_instance.props.splitButton) {\n      triggerElm.setAttribute('role', 'button')\n      triggerElm.setAttribute('tabindex', _instance.props.tabindex)\n      addClass(triggerElm, ns.b('selfdefine'))\n    }\n  }\n\n  function initEvent() {\n    triggerElm?.addEventListener('keydown', handleTriggerKeyDown)\n    dropdownElm.value?.addEventListener('keydown', handleItemKeyDown, true)\n  }\n\n  function initDomOperation() {\n    menuItems.value = dropdownElm.value.querySelectorAll(\n      \"[tabindex='-1']\"\n    ) as unknown as HTMLButtonElement[]\n    menuItemsArray.value = Array.from(menuItems.value)\n\n    initEvent()\n    initAria()\n  }\n\n  function triggerElmFocus() {\n    triggerElm.focus()\n  }\n\n  initDomOperation()\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}