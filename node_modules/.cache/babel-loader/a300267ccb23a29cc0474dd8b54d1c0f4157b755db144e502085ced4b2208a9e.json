{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return _typeof(key) === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (_typeof(input) !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (_typeof(res) !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nimport { defineComponent, useSlots, shallowRef, computed, onBeforeUnmount, provide, toRef, openBlock, createElementBlock, unref, createBlock, createSlots, withCtx, createVNode, mergeProps, renderSlot, createCommentVNode } from 'vue';\nimport '../../form/index.mjs';\nimport { uploadContextKey } from './constants.mjs';\nimport UploadList from './upload-list2.mjs';\nimport UploadContent from './upload-content2.mjs';\nimport { useHandlers } from './use-handlers.mjs';\nimport { uploadProps } from './upload.mjs';\nimport _export_sfc from '../../../_virtual/plugin-vue_export-helper.mjs';\nimport { useFormDisabled } from '../../form/src/hooks/use-form-common-props.mjs';\nvar __default__ = defineComponent({\n  name: \"ElUpload\"\n});\nvar _sfc_main = /* @__PURE__ */defineComponent(_objectSpread(_objectSpread({}, __default__), {}, {\n  props: uploadProps,\n  setup: function setup(__props, _ref) {\n    var expose = _ref.expose;\n    var props = __props;\n    var slots = useSlots();\n    var disabled = useFormDisabled();\n    var uploadRef = shallowRef();\n    var _useHandlers = useHandlers(props, uploadRef),\n      abort = _useHandlers.abort,\n      submit = _useHandlers.submit,\n      clearFiles = _useHandlers.clearFiles,\n      uploadFiles = _useHandlers.uploadFiles,\n      handleStart = _useHandlers.handleStart,\n      handleError = _useHandlers.handleError,\n      handleRemove = _useHandlers.handleRemove,\n      handleSuccess = _useHandlers.handleSuccess,\n      handleProgress = _useHandlers.handleProgress;\n    var isPictureCard = computed(function () {\n      return props.listType === \"picture-card\";\n    });\n    var uploadContentProps = computed(function () {\n      return _objectSpread(_objectSpread({}, props), {}, {\n        fileList: uploadFiles.value,\n        onStart: handleStart,\n        onProgress: handleProgress,\n        onSuccess: handleSuccess,\n        onError: handleError,\n        onRemove: handleRemove\n      });\n    });\n    onBeforeUnmount(function () {\n      uploadFiles.value.forEach(function (_ref2) {\n        var url = _ref2.url;\n        if (url == null ? void 0 : url.startsWith(\"blob:\")) URL.revokeObjectURL(url);\n      });\n    });\n    provide(uploadContextKey, {\n      accept: toRef(props, \"accept\")\n    });\n    expose({\n      abort: abort,\n      submit: submit,\n      clearFiles: clearFiles,\n      handleStart: handleStart,\n      handleRemove: handleRemove\n    });\n    return function (_ctx, _cache) {\n      return openBlock(), createElementBlock(\"div\", null, [unref(isPictureCard) && _ctx.showFileList ? (openBlock(), createBlock(UploadList, {\n        key: 0,\n        disabled: unref(disabled),\n        \"list-type\": _ctx.listType,\n        files: unref(uploadFiles),\n        \"handle-preview\": _ctx.onPreview,\n        onRemove: unref(handleRemove)\n      }, createSlots({\n        append: withCtx(function () {\n          return [createVNode(UploadContent, mergeProps({\n            ref_key: \"uploadRef\",\n            ref: uploadRef\n          }, unref(uploadContentProps)), {\n            \"default\": withCtx(function () {\n              return [unref(slots).trigger ? renderSlot(_ctx.$slots, \"trigger\", {\n                key: 0\n              }) : createCommentVNode(\"v-if\", true), !unref(slots).trigger && unref(slots)[\"default\"] ? renderSlot(_ctx.$slots, \"default\", {\n                key: 1\n              }) : createCommentVNode(\"v-if\", true)];\n            }),\n            _: 3\n          }, 16)];\n        }),\n        _: 2\n      }, [_ctx.$slots.file ? {\n        name: \"default\",\n        fn: withCtx(function (_ref3) {\n          var file = _ref3.file;\n          return [renderSlot(_ctx.$slots, \"file\", {\n            file: file\n          })];\n        })\n      } : void 0]), 1032, [\"disabled\", \"list-type\", \"files\", \"handle-preview\", \"onRemove\"])) : createCommentVNode(\"v-if\", true), !unref(isPictureCard) || unref(isPictureCard) && !_ctx.showFileList ? (openBlock(), createBlock(UploadContent, mergeProps({\n        key: 1,\n        ref_key: \"uploadRef\",\n        ref: uploadRef\n      }, unref(uploadContentProps)), {\n        \"default\": withCtx(function () {\n          return [unref(slots).trigger ? renderSlot(_ctx.$slots, \"trigger\", {\n            key: 0\n          }) : createCommentVNode(\"v-if\", true), !unref(slots).trigger && unref(slots)[\"default\"] ? renderSlot(_ctx.$slots, \"default\", {\n            key: 1\n          }) : createCommentVNode(\"v-if\", true)];\n        }),\n        _: 3\n      }, 16)) : createCommentVNode(\"v-if\", true), _ctx.$slots.trigger ? renderSlot(_ctx.$slots, \"default\", {\n        key: 2\n      }) : createCommentVNode(\"v-if\", true), renderSlot(_ctx.$slots, \"tip\"), !unref(isPictureCard) && _ctx.showFileList ? (openBlock(), createBlock(UploadList, {\n        key: 3,\n        disabled: unref(disabled),\n        \"list-type\": _ctx.listType,\n        files: unref(uploadFiles),\n        \"handle-preview\": _ctx.onPreview,\n        onRemove: unref(handleRemove)\n      }, createSlots({\n        _: 2\n      }, [_ctx.$slots.file ? {\n        name: \"default\",\n        fn: withCtx(function (_ref4) {\n          var file = _ref4.file;\n          return [renderSlot(_ctx.$slots, \"file\", {\n            file: file\n          })];\n        })\n      } : void 0]), 1032, [\"disabled\", \"list-type\", \"files\", \"handle-preview\", \"onRemove\"])) : createCommentVNode(\"v-if\", true)]);\n    };\n  }\n}));\nvar Upload = /* @__PURE__ */_export_sfc(_sfc_main, [[\"__file\", \"/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue\"]]);\nexport { Upload as default };","map":{"version":3,"names":["name","slots","useSlots","disabled","useFormDisabled","uploadRef","shallowRef","_useHandlers","useHandlers","props","abort","submit","clearFiles","uploadFiles","handleStart","handleError","handleRemove","handleSuccess","handleProgress","isPictureCard","computed","listType","uploadContentProps","_objectSpread","fileList","value","onStart","onProgress","onSuccess","onError","onRemove","onBeforeUnmount","forEach","_ref2","url","startsWith","URL","revokeObjectURL","provide","uploadContextKey","accept","toRef","expose"],"sources":["../../../../../../packages/components/upload/src/upload.vue"],"sourcesContent":["<template>\n  <div>\n    <upload-list\n      v-if=\"isPictureCard && showFileList\"\n      :disabled=\"disabled\"\n      :list-type=\"listType\"\n      :files=\"uploadFiles\"\n      :handle-preview=\"onPreview\"\n      @remove=\"handleRemove\"\n    >\n      <template v-if=\"$slots.file\" #default=\"{ file }\">\n        <slot name=\"file\" :file=\"file\" />\n      </template>\n      <template #append>\n        <upload-content ref=\"uploadRef\" v-bind=\"uploadContentProps\">\n          <slot v-if=\"slots.trigger\" name=\"trigger\" />\n          <slot v-if=\"!slots.trigger && slots.default\" />\n        </upload-content>\n      </template>\n    </upload-list>\n\n    <upload-content\n      v-if=\"!isPictureCard || (isPictureCard && !showFileList)\"\n      ref=\"uploadRef\"\n      v-bind=\"uploadContentProps\"\n    >\n      <slot v-if=\"slots.trigger\" name=\"trigger\" />\n      <slot v-if=\"!slots.trigger && slots.default\" />\n    </upload-content>\n\n    <slot v-if=\"$slots.trigger\" />\n    <slot name=\"tip\" />\n    <upload-list\n      v-if=\"!isPictureCard && showFileList\"\n      :disabled=\"disabled\"\n      :list-type=\"listType\"\n      :files=\"uploadFiles\"\n      :handle-preview=\"onPreview\"\n      @remove=\"handleRemove\"\n    >\n      <template v-if=\"$slots.file\" #default=\"{ file }\">\n        <slot name=\"file\" :file=\"file\" />\n      </template>\n    </upload-list>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport {\n  computed,\n  onBeforeUnmount,\n  provide,\n  shallowRef,\n  toRef,\n  useSlots,\n} from 'vue'\nimport { useFormDisabled } from '@element-plus/components/form'\nimport { uploadContextKey } from './constants'\nimport UploadList from './upload-list.vue'\nimport UploadContent from './upload-content.vue'\nimport { useHandlers } from './use-handlers'\nimport { uploadProps } from './upload'\n\nimport type {\n  UploadContentInstance,\n  UploadContentProps,\n} from './upload-content'\n\ndefineOptions({\n  name: 'ElUpload',\n})\n\nconst props = defineProps(uploadProps)\n\nconst slots = useSlots()\nconst disabled = useFormDisabled()\n\nconst uploadRef = shallowRef<UploadContentInstance>()\nconst {\n  abort,\n  submit,\n  clearFiles,\n  uploadFiles,\n  handleStart,\n  handleError,\n  handleRemove,\n  handleSuccess,\n  handleProgress,\n} = useHandlers(props, uploadRef)\n\nconst isPictureCard = computed(() => props.listType === 'picture-card')\n\nconst uploadContentProps = computed<UploadContentProps>(() => ({\n  ...props,\n  fileList: uploadFiles.value,\n  onStart: handleStart,\n  onProgress: handleProgress,\n  onSuccess: handleSuccess,\n  onError: handleError,\n  onRemove: handleRemove,\n}))\n\nonBeforeUnmount(() => {\n  uploadFiles.value.forEach(({ url }) => {\n    if (url?.startsWith('blob:')) URL.revokeObjectURL(url)\n  })\n})\n\nprovide(uploadContextKey, {\n  accept: toRef(props, 'accept'),\n})\n\ndefineExpose({\n  /** @description cancel upload request */\n  abort,\n  /** @description upload the file list manually */\n  submit,\n  /** @description clear the file list  */\n  clearFiles,\n  /** @description select the file manually */\n  handleStart,\n  /** @description remove the file manually */\n  handleRemove,\n})\n</script>\n"],"mappings":";;;;;;;;;;;;;;;iCAoEc;EACZA,IAAM;AACR;;;;;;IAIA,IAAMC,KAAA,GAAQC,QAAS;IACvB,IAAMC,QAAA,GAAWC,eAAgB;IAEjC,IAAMC,SAAA,GAAYC,UAAkC;IAC9C,IAAAC,YAAA,GAUFC,WAAA,CAAYC,KAAA,EAAOJ,SAAS;MAT9BK,KAAA,GAAAH,YAAA,CAAAG,KAAA;MACAC,MAAA,GAAAJ,YAAA,CAAAI,MAAA;MACAC,UAAA,GAAAL,YAAA,CAAAK,UAAA;MACAC,WAAA,GAAAN,YAAA,CAAAM,WAAA;MACAC,WAAA,GAAAP,YAAA,CAAAO,WAAA;MACAC,WAAA,GAAAR,YAAA,CAAAQ,WAAA;MACAC,YAAA,GAAAT,YAAA,CAAAS,YAAA;MACAC,aAAA,GAAAV,YAAA,CAAAU,aAAA;MACAC,cAAA,GAAAX,YAAA,CAAAW,cAAA;IAGF,IAAMC,aAAgB,GAAAC,QAAA,CAAS;MAAA,OAAMX,KAAA,CAAMY,QAAA,KAAa,cAAc;IAAA;IAEhE,IAAAC,kBAAA,GAAqBF,QAAA,CAA6B;MAAA,OAAAG,aAAA,CAAAA,aAAA,KACnDd,KAAA;QACHe,QAAA,EAAUX,WAAY,CAAAY,KAAA;QACtBC,OAAS,EAAAZ,WAAA;QACTa,UAAY,EAAAT,cAAA;QACZU,SAAW,EAAAX,aAAA;QACXY,OAAS,EAAAd,WAAA;QACTe,QAAU,EAAAd;MAAA;IAAA,CACV;IAEFe,eAAA,CAAgB,YAAM;MACpBlB,WAAA,CAAYY,KAAM,CAAAO,OAAA,CAAQ,UAAAC,KAAA,EAAa;QAAA,IAAVC,GAAU,GAAAD,KAAA,CAAVC,GAAU;QACjC,IAAAA,GAAA,gBAAuB,IAAAA,GAAA,CAAAC,UAAA,WAAGC,GAAA,CAAIC,eAAA,CAAgBH,GAAG;MAAA,CACtD;IAAA,CACF;IAEDI,OAAA,CAAQC,gBAAkB;MACxBC,MAAA,EAAQC,KAAM,CAAAhC,KAAA,EAAO,QAAQ;IAAA,CAC9B;IAEYiC,MAAA;MAEXhC,KAAA,EAAAA,KAAA;MAEAC,MAAA,EAAAA,MAAA;MAEAC,UAAA,EAAAA,UAAA;MAEAE,WAAA,EAAAA,WAAA;MAEAE,YAAA,EAAAA;IAAA,CACD"},"metadata":{},"sourceType":"module","externalDependencies":[]}