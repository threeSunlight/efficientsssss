{"ast":null,"code":"import { ref, toRef, shallowRef, computed, unref, watch } from 'vue';\nimport '../../../utils/index.mjs';\nimport './composables/index.mjs';\nimport { useColumns } from './composables/use-columns.mjs';\nimport { useScrollbar } from './composables/use-scrollbar.mjs';\nimport { useRow } from './composables/use-row.mjs';\nimport { useData } from './composables/use-data.mjs';\nimport { useStyles } from './composables/use-styles.mjs';\nimport { isArray } from '@vue/shared';\nfunction useTable(props) {\n  var mainTableRef = ref();\n  var leftTableRef = ref();\n  var rightTableRef = ref();\n  var _useColumns = useColumns(props, toRef(props, \"columns\"), toRef(props, \"fixed\")),\n    columns = _useColumns.columns,\n    columnsStyles = _useColumns.columnsStyles,\n    columnsTotalWidth = _useColumns.columnsTotalWidth,\n    fixedColumnsOnLeft = _useColumns.fixedColumnsOnLeft,\n    fixedColumnsOnRight = _useColumns.fixedColumnsOnRight,\n    hasFixedColumns = _useColumns.hasFixedColumns,\n    mainColumns = _useColumns.mainColumns,\n    onColumnSorted = _useColumns.onColumnSorted;\n  var _useScrollbar = useScrollbar(props, {\n      mainTableRef: mainTableRef,\n      leftTableRef: leftTableRef,\n      rightTableRef: rightTableRef,\n      onMaybeEndReached: onMaybeEndReached\n    }),\n    scrollTo = _useScrollbar.scrollTo,\n    scrollToLeft = _useScrollbar.scrollToLeft,\n    scrollToTop = _useScrollbar.scrollToTop,\n    scrollToRow = _useScrollbar.scrollToRow,\n    onScroll = _useScrollbar.onScroll,\n    onVerticalScroll = _useScrollbar.onVerticalScroll,\n    scrollPos = _useScrollbar.scrollPos;\n  var _useRow = useRow(props, {\n      mainTableRef: mainTableRef,\n      leftTableRef: leftTableRef,\n      rightTableRef: rightTableRef\n    }),\n    expandedRowKeys = _useRow.expandedRowKeys,\n    hoveringRowKey = _useRow.hoveringRowKey,\n    lastRenderedRowIndex = _useRow.lastRenderedRowIndex,\n    isDynamic = _useRow.isDynamic,\n    isResetting = _useRow.isResetting,\n    rowHeights = _useRow.rowHeights,\n    resetAfterIndex = _useRow.resetAfterIndex,\n    onRowExpanded = _useRow.onRowExpanded,\n    onRowHeightChange = _useRow.onRowHeightChange,\n    onRowHovered = _useRow.onRowHovered,\n    onRowsRendered = _useRow.onRowsRendered;\n  var _useData = useData(props, {\n      expandedRowKeys: expandedRowKeys,\n      lastRenderedRowIndex: lastRenderedRowIndex,\n      resetAfterIndex: resetAfterIndex\n    }),\n    data = _useData.data,\n    depthMap = _useData.depthMap;\n  var _useStyles = useStyles(props, {\n      columnsTotalWidth: columnsTotalWidth,\n      data: data,\n      fixedColumnsOnLeft: fixedColumnsOnLeft,\n      fixedColumnsOnRight: fixedColumnsOnRight\n    }),\n    bodyWidth = _useStyles.bodyWidth,\n    fixedTableHeight = _useStyles.fixedTableHeight,\n    mainTableHeight = _useStyles.mainTableHeight,\n    leftTableWidth = _useStyles.leftTableWidth,\n    rightTableWidth = _useStyles.rightTableWidth,\n    headerWidth = _useStyles.headerWidth,\n    rowsHeight = _useStyles.rowsHeight,\n    windowHeight = _useStyles.windowHeight,\n    footerHeight = _useStyles.footerHeight,\n    emptyStyle = _useStyles.emptyStyle,\n    rootStyle = _useStyles.rootStyle,\n    headerHeight = _useStyles.headerHeight;\n  var isScrolling = shallowRef(false);\n  var containerRef = ref();\n  var showEmpty = computed(function () {\n    var noData = unref(data).length === 0;\n    return isArray(props.fixedData) ? props.fixedData.length === 0 && noData : noData;\n  });\n  function getRowHeight(rowIndex) {\n    var estimatedRowHeight = props.estimatedRowHeight,\n      rowHeight = props.rowHeight,\n      rowKey = props.rowKey;\n    if (!estimatedRowHeight) return rowHeight;\n    return unref(rowHeights)[unref(data)[rowIndex][rowKey]] || estimatedRowHeight;\n  }\n  function onMaybeEndReached() {\n    var onEndReached = props.onEndReached;\n    if (!onEndReached) return;\n    var _unref = unref(scrollPos),\n      scrollTop = _unref.scrollTop;\n    var _totalHeight = unref(rowsHeight);\n    var clientHeight = unref(windowHeight);\n    var heightUntilEnd = _totalHeight - (scrollTop + clientHeight) + props.hScrollbarSize;\n    if (unref(lastRenderedRowIndex) >= 0 && _totalHeight === scrollTop + unref(mainTableHeight) - unref(headerHeight)) {\n      onEndReached(heightUntilEnd);\n    }\n  }\n  watch(function () {\n    return props.expandedRowKeys;\n  }, function (val) {\n    return expandedRowKeys.value = val;\n  }, {\n    deep: true\n  });\n  return {\n    columns: columns,\n    containerRef: containerRef,\n    mainTableRef: mainTableRef,\n    leftTableRef: leftTableRef,\n    rightTableRef: rightTableRef,\n    isDynamic: isDynamic,\n    isResetting: isResetting,\n    isScrolling: isScrolling,\n    hoveringRowKey: hoveringRowKey,\n    hasFixedColumns: hasFixedColumns,\n    columnsStyles: columnsStyles,\n    columnsTotalWidth: columnsTotalWidth,\n    data: data,\n    expandedRowKeys: expandedRowKeys,\n    depthMap: depthMap,\n    fixedColumnsOnLeft: fixedColumnsOnLeft,\n    fixedColumnsOnRight: fixedColumnsOnRight,\n    mainColumns: mainColumns,\n    bodyWidth: bodyWidth,\n    emptyStyle: emptyStyle,\n    rootStyle: rootStyle,\n    headerWidth: headerWidth,\n    footerHeight: footerHeight,\n    mainTableHeight: mainTableHeight,\n    fixedTableHeight: fixedTableHeight,\n    leftTableWidth: leftTableWidth,\n    rightTableWidth: rightTableWidth,\n    showEmpty: showEmpty,\n    getRowHeight: getRowHeight,\n    onColumnSorted: onColumnSorted,\n    onRowHovered: onRowHovered,\n    onRowExpanded: onRowExpanded,\n    onRowsRendered: onRowsRendered,\n    onRowHeightChange: onRowHeightChange,\n    scrollTo: scrollTo,\n    scrollToLeft: scrollToLeft,\n    scrollToTop: scrollToTop,\n    scrollToRow: scrollToRow,\n    onScroll: onScroll,\n    onVerticalScroll: onVerticalScroll\n  };\n}\nexport { useTable };","map":{"version":3,"names":["useTable","props","mainTableRef","ref","leftTableRef","rightTableRef","_useColumns","useColumns","toRef","columns","columnsStyles","columnsTotalWidth","fixedColumnsOnLeft","fixedColumnsOnRight","hasFixedColumns","mainColumns","onColumnSorted","_useScrollbar","useScrollbar","onMaybeEndReached","scrollTo","scrollToLeft","scrollToTop","scrollToRow","onScroll","onVerticalScroll","scrollPos","_useRow","useRow","expandedRowKeys","hoveringRowKey","lastRenderedRowIndex","isDynamic","isResetting","rowHeights","resetAfterIndex","onRowExpanded","onRowHeightChange","onRowHovered","onRowsRendered","_useData","useData","data","depthMap","_useStyles","useStyles","bodyWidth","fixedTableHeight","mainTableHeight","leftTableWidth","rightTableWidth","headerWidth","rowsHeight","windowHeight","footerHeight","emptyStyle","rootStyle","headerHeight","isScrolling","shallowRef","containerRef","showEmpty","computed","noData","unref","length","isArray","fixedData","getRowHeight","rowIndex","estimatedRowHeight","rowHeight","rowKey","onEndReached","_unref","scrollTop","_totalHeight","clientHeight","heightUntilEnd","hScrollbarSize","watch","val","value","deep"],"sources":["../../../../../../packages/components/table-v2/src/use-table.ts"],"sourcesContent":["import { computed, ref, shallowRef, toRef, unref, watch } from 'vue'\nimport { isArray } from '@element-plus/utils'\nimport {\n  useColumns,\n  useData,\n  useRow,\n  useScrollbar,\n  useStyles,\n} from './composables'\n\nimport type { TableV2Props } from './table'\nimport type { TableGridInstance } from './table-grid'\n\nfunction useTable(props: TableV2Props) {\n  const mainTableRef = ref<TableGridInstance>()\n  const leftTableRef = ref<TableGridInstance>()\n  const rightTableRef = ref<TableGridInstance>()\n  const {\n    columns,\n    columnsStyles,\n    columnsTotalWidth,\n    fixedColumnsOnLeft,\n    fixedColumnsOnRight,\n    hasFixedColumns,\n    mainColumns,\n\n    onColumnSorted,\n  } = useColumns(props, toRef(props, 'columns'), toRef(props, 'fixed'))\n\n  const {\n    scrollTo,\n    scrollToLeft,\n    scrollToTop,\n    scrollToRow,\n    onScroll,\n    onVerticalScroll,\n    scrollPos,\n  } = useScrollbar(props, {\n    mainTableRef,\n    leftTableRef,\n    rightTableRef,\n\n    onMaybeEndReached,\n  })\n\n  const {\n    expandedRowKeys,\n    hoveringRowKey,\n    lastRenderedRowIndex,\n    isDynamic,\n    isResetting,\n    rowHeights,\n\n    resetAfterIndex,\n    onRowExpanded,\n    onRowHeightChange,\n    onRowHovered,\n    onRowsRendered,\n  } = useRow(props, {\n    mainTableRef,\n    leftTableRef,\n    rightTableRef,\n  })\n\n  const { data, depthMap } = useData(props, {\n    expandedRowKeys,\n    lastRenderedRowIndex,\n    resetAfterIndex,\n  })\n\n  const {\n    bodyWidth,\n    fixedTableHeight,\n    mainTableHeight,\n    leftTableWidth,\n    rightTableWidth,\n    headerWidth,\n    rowsHeight,\n    windowHeight,\n    footerHeight,\n    emptyStyle,\n    rootStyle,\n    headerHeight,\n  } = useStyles(props, {\n    columnsTotalWidth,\n    data,\n    fixedColumnsOnLeft,\n    fixedColumnsOnRight,\n  })\n  // state\n  const isScrolling = shallowRef(false)\n\n  // DOM/Component refs\n  const containerRef = ref()\n\n  const showEmpty = computed(() => {\n    const noData = unref(data).length === 0\n\n    return isArray(props.fixedData)\n      ? props.fixedData.length === 0 && noData\n      : noData\n  })\n\n  function getRowHeight(rowIndex: number) {\n    const { estimatedRowHeight, rowHeight, rowKey } = props\n\n    if (!estimatedRowHeight) return rowHeight\n\n    return (\n      unref(rowHeights)[unref(data)[rowIndex][rowKey]] || estimatedRowHeight\n    )\n  }\n\n  function onMaybeEndReached() {\n    const { onEndReached } = props\n    if (!onEndReached) return\n\n    const { scrollTop } = unref(scrollPos)\n\n    const _totalHeight = unref(rowsHeight)\n    const clientHeight = unref(windowHeight)\n\n    const heightUntilEnd =\n      _totalHeight - (scrollTop + clientHeight) + props.hScrollbarSize\n\n    if (\n      unref(lastRenderedRowIndex) >= 0 &&\n      _totalHeight === scrollTop + unref(mainTableHeight) - unref(headerHeight)\n    ) {\n      onEndReached(heightUntilEnd)\n    }\n  }\n\n  // events\n\n  watch(\n    () => props.expandedRowKeys,\n    (val) => (expandedRowKeys.value = val),\n    {\n      deep: true,\n    }\n  )\n\n  return {\n    // models\n    columns,\n    containerRef,\n    mainTableRef,\n    leftTableRef,\n    rightTableRef,\n    // states\n    isDynamic,\n    isResetting,\n    isScrolling,\n    hoveringRowKey,\n    hasFixedColumns,\n    // records\n    columnsStyles,\n    columnsTotalWidth,\n    data,\n    expandedRowKeys,\n    depthMap,\n    fixedColumnsOnLeft,\n    fixedColumnsOnRight,\n    mainColumns,\n    // metadata\n    bodyWidth,\n    emptyStyle,\n    rootStyle,\n    headerWidth,\n    footerHeight,\n    mainTableHeight,\n    fixedTableHeight,\n    leftTableWidth,\n    rightTableWidth,\n    // flags\n    showEmpty,\n\n    // methods\n    getRowHeight,\n\n    // event handlers\n    onColumnSorted,\n    onRowHovered,\n    onRowExpanded,\n    onRowsRendered,\n    onRowHeightChange,\n    // use scrollbars\n    scrollTo,\n    scrollToLeft,\n    scrollToTop,\n    scrollToRow,\n    onScroll,\n    onVerticalScroll,\n  }\n}\n\nexport { useTable }\n\nexport type UseTableReturn = ReturnType<typeof useTable>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}